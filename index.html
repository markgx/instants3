<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Instascape</title>
  <link rel="stylesheet" href="assets/styles.css"></link>

  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/jquery.transit/0.9.9/jquery.transit.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/underscore.js/1.4.3/underscore-min.js"></script>
  <script src="assets/instagram-js-sdk.js"></script>

  <script type="text/javascript">
    window.options = {
      imageLength: 275,
      intervalMS: 2000,
      fadeDelayMS: 15000,
      fadeOutMS: 5000
    };

    var IG = new Instagram();

    if (!window.location.hash) {
      IG.auth(igParams); //then will go to the authorize page

      var igParams = {
        client_id    : '1e4ea3f6ea2a49899f32429d9a53566b',
        redirect_uri : 'http://localhost:8000/',
        scope        : 'basic',
        response_type: 'token'
      };
    } else {

      //handle the fn token
      var token = IG.getToken();

      //you need to set token before you use it
      IG.setOptions({
        token: token
      });
    }

    $(document).ready(function() {
      IG.getPopular(function(result) {
        window.images = _.map(result.data, function(o) {
          return o.images.low_resolution.url
        });

        // preload images
        $(window.images).each(function() {
          $('<img />').attr('src', this).appendTo('body').css('display','none');
        });
      });

      window.count = 0;
      window.interval = setInterval('showImage(images[window.count])', options.intervalMS);
    });

    function showImage(imageUrl) {
      var $image = $('<div class="image"><img src="' + imageUrl + '" /></div>');

      // randomize side to throw from

      var side = Math.floor(Math.random() * 4);

      switch (side) {
        case 0: // top
          $image.css({ top: options.imageLength * -1, left: randomX() });
          break;
        case 1: // right
          $image.css({ top: randomY(), left: window.innerWidth });
          break;
        case 2: // bottom
          $image.css({ top: window.innerHeight, left: randomX() });
          break;
        case 3: // left
          $image.css({ top: randomY(), left: options.imageLength * -1 });
          break;
      }

      $('#board').append($image);

      // randomize throw

      var spin = 1;
      if (Math.round(Math.random()) == 0) {
        spin = -1;
      }

      var rotateOffset = Math.floor(Math.random() * 15);
      var spinCount = Math.floor(Math.random() * 2); // 0 or 1

      var rotate = ((360 * spinCount) + rotateOffset) * spin;

      if (spinCount == 0) {
        // if no spin, do half a spin
        $image.css({ rotate: 180 });
      }

      var left = randomX();
      var top = randomY();

      $image
        .transition({ left: left, top: top, rotate: rotate, easing: 'snap', duration: 1500 })
        .transition({ opacity: 0, delay: options.fadeDelayMS }, options.fadeOutMS, 'in', function() {
          this.remove();
        });

      // cycle through images
      if (count == images.length - 1) {
        count = 0;
      } else {
        count++;
      }
    }

    function randomX() {
      return Math.floor(Math.random() * (window.innerWidth - options.imageLength));
    }

    function randomY() {
      return Math.floor(Math.random() * (window.innerHeight - options.imageLength));
    }
  </script>
</head>
<body>
  <div id="board"></div>
</body>
</html>
